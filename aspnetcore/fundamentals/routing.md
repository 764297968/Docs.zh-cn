---
title: ASP.NET Core 中的路由
author: ardalis
description: 了解 ASP.NET Core 路由功能如何负责将传入请求映射到路由处理程序。
ms.author: riande
ms.custom: mvc
ms.date: 10/01/2018
uid: fundamentals/routing
ms.openlocfilehash: a014782ba503bc8bd0fdefb4cb4f382aa8fde4cd
ms.sourcegitcommit: c43a6f1fe72d7c2db4b5815fd532f2b45d964e07
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/30/2018
ms.locfileid: "50244965"
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="3d89b-103">ASP.NET Core 中的路由</span><span class="sxs-lookup"><span data-stu-id="3d89b-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="3d89b-104">撰写者：[Ryan Nowak](https://github.com/rynowak)、[Steve Smith](https://ardalis.com/) 和 [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="3d89b-104">By [Ryan Nowak](https://github.com/rynowak), [Steve Smith](https://ardalis.com/), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="3d89b-105">路由功能负责将传入请求映射到路由处理程序。</span><span class="sxs-lookup"><span data-stu-id="3d89b-105">Routing functionality is responsible for mapping an incoming request to a route handler.</span></span> <span data-ttu-id="3d89b-106">路由在应用中定义，并在应用启动时进行配置。</span><span class="sxs-lookup"><span data-stu-id="3d89b-106">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="3d89b-107">路由可以选择从请求包含的 URL 中提取值，然后这些值便可用于处理请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-107">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="3d89b-108">通过使用应用中的路由信息，路由功能还能生成要映射到路由处理程序的 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-108">Using route information from the app, the routing functionality is also able to generate URLs that map to route handlers.</span></span> <span data-ttu-id="3d89b-109">因此，路由可以根据 URL 查找路由处理程序，或者根据路由处理程序信息查找给定路由处理程序对应的 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-109">Therefore, routing can find a route handler based on a URL, or find the URL corresponding to a given route handler based on route handler information.</span></span>

<span data-ttu-id="3d89b-110">大多数应用应选择基本的描述性路由方案，让 URL 有可读性和意义。</span><span class="sxs-lookup"><span data-stu-id="3d89b-110">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="3d89b-111">默认传统路由 `{controller=Home}/{action=Index}/{id?}`：</span><span class="sxs-lookup"><span data-stu-id="3d89b-111">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="3d89b-112">支持基本的描述性路由方案：</span><span class="sxs-lookup"><span data-stu-id="3d89b-112">Supports a basic and descriptive routing scheme:</span></span>
* <span data-ttu-id="3d89b-113">是供浏览器使用的 Web 应用的理想入手点。</span><span class="sxs-lookup"><span data-stu-id="3d89b-113">Is a good starting point for web apps intended for use by browsers.</span></span>

<span data-ttu-id="3d89b-114">在专业化情况（例如，博客、电子商务）下，通常会使用[属性路由](xref:mvc/controllers/routing#attribute-routing)或专用传统路由，将其他简化路由添加到应用的高流量区域。</span><span class="sxs-lookup"><span data-stu-id="3d89b-114">It's common to add additional terse routes to high traffic areas of the app in specialized situations (for example, blog, ecommerce) using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span>

<span data-ttu-id="3d89b-115">Web API 应使用属性路由，将应用功能建模为一组资源，其中操作是由 HTTP 谓词表示。</span><span class="sxs-lookup"><span data-stu-id="3d89b-115">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="3d89b-116">也就是说，对同一逻辑资源执行的许多操作（例如，GET、POST）都将使用相同 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-116">This means that many operations (for example, GET, POST) on the same logical resource will use the same URL.</span></span> <span data-ttu-id="3d89b-117">属性路由提供认真设计 API URL 空间所需的控制级别。</span><span class="sxs-lookup"><span data-stu-id="3d89b-117">Attribute routing provides a level of control that is needed to carefully design an API's URL-space.</span></span>

<span data-ttu-id="3d89b-118">借助 MVC 的 URL 生成支持，无需通过硬编码 URL 将应用关联到一起，即可开发应用。</span><span class="sxs-lookup"><span data-stu-id="3d89b-118">MVC's URL generation support allows the app to be developed without hard coding the URLs to link the app together.</span></span> <span data-ttu-id="3d89b-119">这样，便可从基本路由配置入手，并在确定应用形状后修改路由。</span><span class="sxs-lookup"><span data-stu-id="3d89b-119">This allows for starting with a basic routing configuration, and modifying the routes after the app's shape is determined.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3d89b-120">本文档介绍较低级别的 ASP.NET Core 路由。</span><span class="sxs-lookup"><span data-stu-id="3d89b-120">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="3d89b-121">有关 ASP.NET Core MVC 路由的信息，请参阅 <xref:mvc/controllers/routing>。</span><span class="sxs-lookup"><span data-stu-id="3d89b-121">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="3d89b-122">[查看或下载示例代码](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples)（[如何下载](xref:index#how-to-download-a-sample)）</span><span class="sxs-lookup"><span data-stu-id="3d89b-122">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="3d89b-123">路由基础知识</span><span class="sxs-lookup"><span data-stu-id="3d89b-123">Routing basics</span></span>

<span data-ttu-id="3d89b-124">路由使用路由（<xref:Microsoft.AspNetCore.Routing.IRouter> 的实现）：</span><span class="sxs-lookup"><span data-stu-id="3d89b-124">Routing uses *routes* (implementations of <xref:Microsoft.AspNetCore.Routing.IRouter>) to:</span></span>

* <span data-ttu-id="3d89b-125">将传入请求映射到路由处理程序。</span><span class="sxs-lookup"><span data-stu-id="3d89b-125">Map incoming requests to *route handlers*.</span></span>
* <span data-ttu-id="3d89b-126">生成响应中使用的 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-126">Generate URLs used in responses.</span></span>

<span data-ttu-id="3d89b-127">通常情况下，应用具有一个路由集合。</span><span class="sxs-lookup"><span data-stu-id="3d89b-127">Generally, an app has a single collection of routes.</span></span> <span data-ttu-id="3d89b-128">请求到达时，将按顺序处理路由集合。</span><span class="sxs-lookup"><span data-stu-id="3d89b-128">When a request arrives, the route collection is processed in order.</span></span> <span data-ttu-id="3d89b-129">传入请求通过对路由集合中的每个可用路由调用 <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> 方法来查找与请求 URL 匹配的路由。</span><span class="sxs-lookup"><span data-stu-id="3d89b-129">The incoming request looks for a route that matches the request URL by calling the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each available route in the route collection.</span></span> <span data-ttu-id="3d89b-130">与此相反，响应可根据路由信息使用路由生成 URL（例如，用于重定向或链接），并因此避免需要硬编码 URL，这有助于可维护性。</span><span class="sxs-lookup"><span data-stu-id="3d89b-130">By contrast, a response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid having to hard-code URLs, which helps maintainability.</span></span>

<span data-ttu-id="3d89b-131">路由通过 <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> 类连接到[中间件](xref:fundamentals/middleware/index)管道。</span><span class="sxs-lookup"><span data-stu-id="3d89b-131">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="3d89b-132">[ASP.NET Core MVC](xref:mvc/overview) 向中间件管道添加路由，作为其配置的一部分。</span><span class="sxs-lookup"><span data-stu-id="3d89b-132">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration.</span></span> <span data-ttu-id="3d89b-133">若要了解如何使用路由作为独立组件，请参阅[使用路由中间件](#use-routing-middleware)部分。</span><span class="sxs-lookup"><span data-stu-id="3d89b-133">To learn about using routing as a standalone component, see [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="3d89b-134">URL 匹配</span><span class="sxs-lookup"><span data-stu-id="3d89b-134">URL matching</span></span>

<span data-ttu-id="3d89b-135">URL 匹配是一个过程，通过该过程，路由可向处理程序调度传入请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-135">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="3d89b-136">此过程基于 URL 路径中的数据，但可以进行扩展以考虑请求中的任何数据。</span><span class="sxs-lookup"><span data-stu-id="3d89b-136">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="3d89b-137">向单独的处理程序调度请求的功能是缩放应用的大小和复杂性的关键。</span><span class="sxs-lookup"><span data-stu-id="3d89b-137">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="3d89b-138">传入请求将进入 `RouterMiddleware`，后者将对序列中的每个路由调用 <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> 方法。</span><span class="sxs-lookup"><span data-stu-id="3d89b-138">Incoming requests enter the `RouterMiddleware`, which calls the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in sequence.</span></span> <span data-ttu-id="3d89b-139"><xref:Microsoft.AspNetCore.Routing.IRouter> 实例将选择是否通过将 [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) 设置为非 NULL <xref:Microsoft.AspNetCore.Http.RequestDelegate> 来处理请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-139">The <xref:Microsoft.AspNetCore.Routing.IRouter> instance chooses whether to *handle* the request by setting the [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) to a non-null <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="3d89b-140">如果路由为请求设置处理程序，将停止路由处理，并调用处理程序来处理该请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-140">If a route sets a handler for the request, route processing stops, and the handler is invoked to process the request.</span></span> <span data-ttu-id="3d89b-141">如果尝试了所有路由，且请求未找到任何处理程序，中间件将调用 next，请求管道中的下一个中间件将被调用。</span><span class="sxs-lookup"><span data-stu-id="3d89b-141">If all routes are tried and no handler is found for the request, the middleware calls *next*, and the next middleware in the request pipeline is invoked.</span></span>

<span data-ttu-id="3d89b-142">`RouteAsync` 的主要输入是与当前请求关联的 [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-142">The primary input to `RouteAsync` is the [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associated with the current request.</span></span> <span data-ttu-id="3d89b-143">`RouteContext.Handler` 和 [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) 是路由匹配后设置的输出。</span><span class="sxs-lookup"><span data-stu-id="3d89b-143">The `RouteContext.Handler` and [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) are outputs set after a route matches.</span></span>

<span data-ttu-id="3d89b-144">`RouteAsync` 期间的匹配还可根据迄今执行的请求处理将 `RouteContext.RouteData` 的属性设为适当的值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-144">A match during `RouteAsync` also sets the properties of the `RouteContext.RouteData` to appropriate values based on the request processing performed thus far.</span></span> <span data-ttu-id="3d89b-145">如果路由与请求匹配，`RouteContext.RouteData` 将包含有关结果的重要状态信息。</span><span class="sxs-lookup"><span data-stu-id="3d89b-145">If a route matches a request, the `RouteContext.RouteData` contains important state information about the *result*.</span></span>

<span data-ttu-id="3d89b-146">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) 是从路由中生成的路由值的字典。</span><span class="sxs-lookup"><span data-stu-id="3d89b-146">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="3d89b-147">这些值通常通过标记 URL 来确定，可用来接受用户输入，或者在应用内作出进一步的调度决策。</span><span class="sxs-lookup"><span data-stu-id="3d89b-147">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="3d89b-148">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) 是一个与匹配的路由相关的其他数据的属性包。</span><span class="sxs-lookup"><span data-stu-id="3d89b-148">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="3d89b-149">提供 `DataTokens` 以支持将状态数据与每个路由相关联，以便应用稍后可根据所匹配的路由作出决策。</span><span class="sxs-lookup"><span data-stu-id="3d89b-149">`DataTokens` are provided to support associating state data with each route so that the app can make decisions later based on which route matched.</span></span> <span data-ttu-id="3d89b-150">这些值是开发者定义的，不会影响通过任何方式路由的行为。</span><span class="sxs-lookup"><span data-stu-id="3d89b-150">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="3d89b-151">此外，存储于 `RouteData.DataTokens` 中的值可以属于任何类型，与 `RouteData.Values` 相反，后者必须能够轻松转换为字符串，或从字符串进行转换。</span><span class="sxs-lookup"><span data-stu-id="3d89b-151">Additionally, values stashed in `RouteData.DataTokens` can be of any type, in contrast to `RouteData.Values`, which must be easily convertible to and from strings.</span></span>

<span data-ttu-id="3d89b-152">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers*) 是参与成功匹配请求的路由的列表。</span><span class="sxs-lookup"><span data-stu-id="3d89b-152">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers*) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="3d89b-153">路由可以相互嵌套。</span><span class="sxs-lookup"><span data-stu-id="3d89b-153">Routes can be nested inside of one another.</span></span> <span data-ttu-id="3d89b-154">`Routers` 属性可以通过导致匹配的逻辑路由树反映该路径。</span><span class="sxs-lookup"><span data-stu-id="3d89b-154">The `Routers` property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="3d89b-155">通常情况下，`Routers` 中的第一项是路由集合，应该用于生成 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-155">Generally, the first item in `Routers` is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="3d89b-156">`Routers` 中的最后一项是匹配的路由处理程序。</span><span class="sxs-lookup"><span data-stu-id="3d89b-156">The last item in `Routers` is the route handler that matched.</span></span>

### <a name="url-generation"></a><span data-ttu-id="3d89b-157">URL 生成</span><span class="sxs-lookup"><span data-stu-id="3d89b-157">URL generation</span></span>

<span data-ttu-id="3d89b-158">URL 生成是通过其可根据一组路由值创建 URL 路径的过程。</span><span class="sxs-lookup"><span data-stu-id="3d89b-158">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="3d89b-159">这需要考虑处理程序与访问它们的 URL 之间的逻辑分隔。</span><span class="sxs-lookup"><span data-stu-id="3d89b-159">This allows for a logical separation between your handlers and the URLs that access them.</span></span>

<span data-ttu-id="3d89b-160">URL 遵循类似的迭代过程，但开头是将用户或框架代码调用到路由集合的 <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> 方法中。</span><span class="sxs-lookup"><span data-stu-id="3d89b-160">URL generation follows a similar iterative process, but it starts with user or framework code calling into the <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method of the route collection.</span></span> <span data-ttu-id="3d89b-161">然后，每个路由会有序地调用其 `GetVirtualPath` 方法，直到返回非 NULL 的 <xref:Microsoft.AspNetCore.Routing.VirtualPathData>。</span><span class="sxs-lookup"><span data-stu-id="3d89b-161">Each *route* then has its `GetVirtualPath` method called in sequence until a non-null <xref:Microsoft.AspNetCore.Routing.VirtualPathData> is returned.</span></span>

<span data-ttu-id="3d89b-162">`GetVirtualPath` 的主输入有：</span><span class="sxs-lookup"><span data-stu-id="3d89b-162">The primary inputs to `GetVirtualPath` are:</span></span>

* [<span data-ttu-id="3d89b-163">VirtualPathContext.HttpContext</span><span class="sxs-lookup"><span data-stu-id="3d89b-163">VirtualPathContext.HttpContext</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext*)
* [<span data-ttu-id="3d89b-164">VirtualPathContext.Values</span><span class="sxs-lookup"><span data-stu-id="3d89b-164">VirtualPathContext.Values</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*)
* [<span data-ttu-id="3d89b-165">VirtualPathContext.AmbientValues</span><span class="sxs-lookup"><span data-stu-id="3d89b-165">VirtualPathContext.AmbientValues</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*)

<span data-ttu-id="3d89b-166">路由主要使用 `Values` 和 `AmbientValues` 提供的路由值来确定是否可能生成 URL 以及要包括哪些值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-166">Routes primarily use the route values provided by the `Values` and `AmbientValues` to decide whether it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="3d89b-167">`AmbientValues` 是路由值的集合，这些值是通过将当前请求与路由系统相匹配而产生的。</span><span class="sxs-lookup"><span data-stu-id="3d89b-167">The `AmbientValues` are the set of route values that were produced from matching the current request with the routing system.</span></span> <span data-ttu-id="3d89b-168">与此相反，`Values` 是指定如何为当前操作生成所需 URL 的路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-168">In contrast, `Values` are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="3d89b-169">当路由需要获取与当前上下文关联的服务或其他数据时，需提供 `HttpContext`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-169">The `HttpContext` is provided in case a route needs to obtain services or additional data associated with the current context.</span></span>

> [!TIP]
> <span data-ttu-id="3d89b-170">将 [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) 视为 [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*) 的一组替代。</span><span class="sxs-lookup"><span data-stu-id="3d89b-170">Think of [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) as being a set of overrides for the [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span></span> <span data-ttu-id="3d89b-171">URL 生成尝试重复使用当前请求中的路由值，以便轻松使用相同路由或路由值生成链接的 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-171">URL generation attempts to reuse route values from the current request to make it easy to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="3d89b-172">`GetVirtualPath` 的输出是 `VirtualPathData`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-172">The output of `GetVirtualPath` is a `VirtualPathData`.</span></span> <span data-ttu-id="3d89b-173">`VirtualPathData` 是 `RouteData` 的并行值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-173">`VirtualPathData` is a parallel of `RouteData`.</span></span> <span data-ttu-id="3d89b-174">`VirtualPathData` 包含输出 URL 的 `VirtualPath` 以及路由应该设置的某些其他属性。</span><span class="sxs-lookup"><span data-stu-id="3d89b-174">`VirtualPathData` contains the `VirtualPath` for the output URL and some additional properties that should be set by the route.</span></span>

<span data-ttu-id="3d89b-175">[VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) 属性包含路由生成的虚拟路径。</span><span class="sxs-lookup"><span data-stu-id="3d89b-175">The [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="3d89b-176">你可能需要进一步处理路径，具体取决于你的需求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-176">Depending on your needs, you may need to process the path further.</span></span> <span data-ttu-id="3d89b-177">如果要在 HTML 中呈现生成的 URL，请预置应用的基路径。</span><span class="sxs-lookup"><span data-stu-id="3d89b-177">If you want to render the generated URL in HTML, prepend the base path of the app.</span></span>

<span data-ttu-id="3d89b-178">[VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) 是对已成功生成 URL 的路由的引用。</span><span class="sxs-lookup"><span data-stu-id="3d89b-178">The [VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="3d89b-179">[VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) 属性是生成 URL 的路由的其他相关数据的字典。</span><span class="sxs-lookup"><span data-stu-id="3d89b-179">The [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="3d89b-180">这是 [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) 的并性值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-180">This is the parallel of [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span></span>

### <a name="creating-routes"></a><span data-ttu-id="3d89b-181">创建路由</span><span class="sxs-lookup"><span data-stu-id="3d89b-181">Creating routes</span></span>

<span data-ttu-id="3d89b-182">路由提供 <xref:Microsoft.AspNetCore.Routing.Route> 类，作为 <xref:Microsoft.AspNetCore.Routing.IRouter> 的标准实现。</span><span class="sxs-lookup"><span data-stu-id="3d89b-182">Routing provides the <xref:Microsoft.AspNetCore.Routing.Route> class as the standard implementation of <xref:Microsoft.AspNetCore.Routing.IRouter>.</span></span> <span data-ttu-id="3d89b-183">`Route` 使用 route template 语法来定义调用 <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> 时针对 URL 路径进行匹配的模式。</span><span class="sxs-lookup"><span data-stu-id="3d89b-183">`Route` uses the *route template* syntax to define patterns that match against the URL path when <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is called.</span></span> <span data-ttu-id="3d89b-184">调用 `GetVirtualPath` 时，`Route` 使用同一路由模板生成 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-184">`Route` uses the same route template to generate a URL when `GetVirtualPath` is called.</span></span>

<span data-ttu-id="3d89b-185">大多数应用通过调用 <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> 或 <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> 上定义的一种类似的扩展方法来创建路由。</span><span class="sxs-lookup"><span data-stu-id="3d89b-185">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="3d89b-186">所有方法都会创建 <xref:Microsoft.AspNetCore.Routing.Route> 的实例，并将其添加到路由集合中。</span><span class="sxs-lookup"><span data-stu-id="3d89b-186">All of these methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="3d89b-187">`MapRoute` 并不使用路由处理程序参数。</span><span class="sxs-lookup"><span data-stu-id="3d89b-187">`MapRoute` doesn't take a route handler parameter.</span></span> <span data-ttu-id="3d89b-188">`MapRoute` 仅添加由 <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*> 处理的路由。</span><span class="sxs-lookup"><span data-stu-id="3d89b-188">`MapRoute` only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="3d89b-189">由于默认处理程序是 `IRouter`，它可能决定不处理该请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-189">Since the default handler is an `IRouter`, it may decide not to handle the request.</span></span> <span data-ttu-id="3d89b-190">例如，ASP.NET Core MVC 通常被配置为默认处理程序，仅处理与可用控制器和操作匹配的请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-190">For example, ASP.NET Core MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="3d89b-191">若要详细了解到 MVC 的路由，请参阅 <xref:mvc/controllers/routing>。</span><span class="sxs-lookup"><span data-stu-id="3d89b-191">To learn more about routing to MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="3d89b-192">以下代码示例是典型 ASP.NET Core MVC 路由定义使用的一个 `MapRoute` 调用示例：</span><span class="sxs-lookup"><span data-stu-id="3d89b-192">The following code example is an example of a `MapRoute` call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="3d89b-193">此模板与 `/Products/Details/17` 等 URL 路径相匹配，并且提取路由值 `{ controller = Products, action = Details, id = 17 }`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-193">This template matches a URL path like `/Products/Details/17` and extracts the route values `{ controller = Products, action = Details, id = 17 }`.</span></span> <span data-ttu-id="3d89b-194">路由值是通过将 URL 路径拆分成段，并且将每段与路由模板中的路由参数名称相匹配来确定的。</span><span class="sxs-lookup"><span data-stu-id="3d89b-194">The route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="3d89b-195">路由参数已命名。</span><span class="sxs-lookup"><span data-stu-id="3d89b-195">Route parameters are named.</span></span> <span data-ttu-id="3d89b-196">它们是通过将参数名称括在大括号 `{ ... }` 中进行定义的。</span><span class="sxs-lookup"><span data-stu-id="3d89b-196">They're defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="3d89b-197">上述模板还可匹配 URL 路径 `/`，并且将生成值 `{ controller = Home, action = Index }`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-197">The preceding template could also match the URL path `/` and would produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="3d89b-198">这是因为 `{controller}` 和 `{action}` 路由参数具有默认值，且 `id` 路由参数是可选的。</span><span class="sxs-lookup"><span data-stu-id="3d89b-198">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="3d89b-199">路由参数名称为参数定义默认值后，等号 `=` 后将有一个值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-199">An equals `=` sign followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="3d89b-200">路由参数名称后的问号 `?` 将参数定义为可选。</span><span class="sxs-lookup"><span data-stu-id="3d89b-200">A question mark `?` after the route parameter name defines the parameter as optional.</span></span> <span data-ttu-id="3d89b-201">路由匹配时，具有默认值的路由参数始终会生成路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-201">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="3d89b-202">如果没有相应的 URL 路径段，则可选参数不会生成路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-202">Optional parameters don't produce a route value if there was no corresponding URL path segment.</span></span>

<span data-ttu-id="3d89b-203">有关路由模板功能和语法的详细说明，请参阅 [route-template-reference](#route-template-reference)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-203">See [route-template-reference](#route-template-reference) for a thorough description of route template features and syntax.</span></span>

<span data-ttu-id="3d89b-204">此示例包括路由约束：</span><span class="sxs-lookup"><span data-stu-id="3d89b-204">This example includes a *route constraint*:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="3d89b-205">此模板与类似于 `/Products/Details/17` 而不是 `/Products/Details/Apples` 的 URL 路径相匹配。</span><span class="sxs-lookup"><span data-stu-id="3d89b-205">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="3d89b-206">路由参数定义 `{id:int}` 为 `id` 路由参数定义[路由约束](#route-constraint-reference)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-206">The route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter.</span></span> <span data-ttu-id="3d89b-207">路由约束实现 <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> 并检查路由值，以验证它们。</span><span class="sxs-lookup"><span data-stu-id="3d89b-207">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="3d89b-208">在此示例中，路由值 `id` 必须可转换为整数。</span><span class="sxs-lookup"><span data-stu-id="3d89b-208">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="3d89b-209">有关框架提供的路由约束的更详细说明，请参阅 [route-constraint-reference](#route-constraint-reference)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-209">See [route-constraint-reference](#route-constraint-reference) for a more detailed explanation of route constraints that are provided by the framework.</span></span>

<span data-ttu-id="3d89b-210">其他 `MapRoute` 重载接受 `constraints`、`dataTokens` 和 `defaults` 的值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-210">Additional overloads of `MapRoute` accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="3d89b-211">`MapRoute` 的此类附加参数被定义为 `object` 类型。</span><span class="sxs-lookup"><span data-stu-id="3d89b-211">These additional parameters of `MapRoute` are defined as type `object`.</span></span> <span data-ttu-id="3d89b-212">这些参数的典型用法是传递匿名类型化对象，其中匿名类型的属性名匹配路由参数名称。</span><span class="sxs-lookup"><span data-stu-id="3d89b-212">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="3d89b-213">以下两个示例可创建等效路由：</span><span class="sxs-lookup"><span data-stu-id="3d89b-213">The following two examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="3d89b-214">定义约束和默认值的内联语法对于简单路由很方便。</span><span class="sxs-lookup"><span data-stu-id="3d89b-214">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="3d89b-215">但是，存在内联语法不支持的功能，例如数据令牌。</span><span class="sxs-lookup"><span data-stu-id="3d89b-215">However, there are features, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="3d89b-216">下面的代码示例演示了更多方案：</span><span class="sxs-lookup"><span data-stu-id="3d89b-216">The following example demonstrates a few more scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{*article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="3d89b-217">此模板与 `/Blog/All-About-Routing/Introduction` 等 URL 路径相匹配，并且提取值 `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-217">This template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="3d89b-218">`controller` 和 `action` 的默认路由值由路由生成，即便模板中没有对应的路由参数。</span><span class="sxs-lookup"><span data-stu-id="3d89b-218">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="3d89b-219">可在路由模板中指定默认值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-219">Default values can be specified in the route template.</span></span> <span data-ttu-id="3d89b-220">根据路由参数名称前的星号  *外观，`article` 路由参数被定义为全方位*`*`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-220">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk `*` before the route parameter name.</span></span> <span data-ttu-id="3d89b-221">全方位路由参数可捕获 URL 路径的其余部分，也能匹配空白字符串。</span><span class="sxs-lookup"><span data-stu-id="3d89b-221">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="3d89b-222">此示例可添加路由约束和数据令牌：</span><span class="sxs-lookup"><span data-stu-id="3d89b-222">This example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="3d89b-223">此模板与 `/en-US/Products/5` 等 URL 路径相匹配，并且提取值 `{ controller = Products, action = Details, id = 5 }` 和数据令牌 `{ locale = en-US }`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-223">This template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![本地 Windows 令牌](routing/_static/tokens.png)

### <a name="url-generation"></a><span data-ttu-id="3d89b-225">URL 生成</span><span class="sxs-lookup"><span data-stu-id="3d89b-225">URL generation</span></span>

<span data-ttu-id="3d89b-226">`Route` 类还可通过将一组路由值与其路由模板组合来生成 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-226">The `Route` class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="3d89b-227">从逻辑上来说，这是匹配 URL 路径的反向过程。</span><span class="sxs-lookup"><span data-stu-id="3d89b-227">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="3d89b-228">为更好了解 URL 生成，请想象你要生成的 URL，然后考虑路由模板将如何匹配该 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-228">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="3d89b-229">将生成什么值？</span><span class="sxs-lookup"><span data-stu-id="3d89b-229">What values would be produced?</span></span> <span data-ttu-id="3d89b-230">这大致相当于 URL 在 `Route` 类中的生成方式。</span><span class="sxs-lookup"><span data-stu-id="3d89b-230">This is the rough equivalent of how URL generation works in the `Route` class.</span></span>

<span data-ttu-id="3d89b-231">此示例使用基本的 ASP.NET Core MVC 样式路由：</span><span class="sxs-lookup"><span data-stu-id="3d89b-231">This example uses a basic ASP.NET Core MVC style route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="3d89b-232">使用路由值 `{ controller = Products, action = List }`，此路由将生成 URL `/Products/List`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-232">With the route values `{ controller = Products, action = List }`, this route generates the URL `/Products/List`.</span></span> <span data-ttu-id="3d89b-233">路由值将替换为相应的路由参数，以形成 URL 路径。</span><span class="sxs-lookup"><span data-stu-id="3d89b-233">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="3d89b-234">由于 `id` 属于可选路由参数，因此它可以没有值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-234">Since `id` is an optional route parameter, it's no problem that it doesn't have a value.</span></span>

<span data-ttu-id="3d89b-235">使用路由值 `{ controller = Home, action = Index }`，此路由将生成 URL `/`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-235">With the route values `{ controller = Home, action = Index }`, this route generates the URL `/`.</span></span> <span data-ttu-id="3d89b-236">提供的路由值与默认值相匹配，因此可以安全忽略这些值对应的段。</span><span class="sxs-lookup"><span data-stu-id="3d89b-236">The route values that were provided match the default values so that the segments corresponding to those values can be safely omitted.</span></span> <span data-ttu-id="3d89b-237">已生成的两个 URL 将往返这个路由定义，并生成用于生成该 URL 的相同路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-237">Both URLs generated round-trip with this route definition and produce the same route values that were used to generate the URL.</span></span>

> [!TIP]
> <span data-ttu-id="3d89b-238">使用 ASP.NET Core MVC 应用应该使用 <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> 生成 URL，而不是直接调用到路由。</span><span class="sxs-lookup"><span data-stu-id="3d89b-238">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="3d89b-239">有关 URL 生成的详细信息，请参阅 [url-generation-reference](#url-generation-reference)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-239">For more information about URL generation, see [url-generation-reference](#url-generation-reference).</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="3d89b-240">使用路由中间件</span><span class="sxs-lookup"><span data-stu-id="3d89b-240">Use Routing Middleware</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="3d89b-241">引用应用项目文件中的 [Microsoft.AspNetCore.App 元包](xref:fundamentals/metapackage-app)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-241">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

::: moniker-end

::: moniker range="= aspnetcore-2.0"

<span data-ttu-id="3d89b-242">引用应用项目文件中的 [Microsoft.AspNetCore.All 元包](xref:fundamentals/metapackage)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-242">Reference the [Microsoft.AspNetCore.All metapackage](xref:fundamentals/metapackage) in the app's project file.</span></span>

::: moniker-end

::: moniker range="< aspnetcore-2.0"

<span data-ttu-id="3d89b-243">引用应用项目文件中的 [Microsoft.AspNetCore.Routing](https://www.nuget.org/packages/Microsoft.AspNetCore.Routing/)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-243">Reference the [Microsoft.AspNetCore.Routing](https://www.nuget.org/packages/Microsoft.AspNetCore.Routing/) in the app's project file.</span></span>

::: moniker-end

<span data-ttu-id="3d89b-244">将路由添加到 `Startup.ConfigureServices` 中的服务容器：</span><span class="sxs-lookup"><span data-stu-id="3d89b-244">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

::: moniker-end

<span data-ttu-id="3d89b-245">必须在 `Startup.Configure` 方法中配置路由。</span><span class="sxs-lookup"><span data-stu-id="3d89b-245">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="3d89b-246">示例应用使用这些 API：</span><span class="sxs-lookup"><span data-stu-id="3d89b-246">The sample app uses these APIs:</span></span>

* `RouteBuilder`
* `Build`
* <span data-ttu-id="3d89b-247">`MapGet` &ndash; 仅匹配 HTTP GET 请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-247">`MapGet` &ndash; Matches only HTTP GET requests.</span></span>
* `UseRouter`

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

::: moniker-end

<span data-ttu-id="3d89b-248">下表显示了具有给定 URI 的响应。</span><span class="sxs-lookup"><span data-stu-id="3d89b-248">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="3d89b-249">URI</span><span class="sxs-lookup"><span data-stu-id="3d89b-249">URI</span></span>                  | <span data-ttu-id="3d89b-250">响应</span><span class="sxs-lookup"><span data-stu-id="3d89b-250">Response</span></span>                                          |
| -------------------- | ------------------------------------------------- |
| <span data-ttu-id="3d89b-251">/package/create/3</span><span class="sxs-lookup"><span data-stu-id="3d89b-251">/package/create/3</span></span>    | <span data-ttu-id="3d89b-252">Hello!</span><span class="sxs-lookup"><span data-stu-id="3d89b-252">Hello!</span></span> <span data-ttu-id="3d89b-253">Route values: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="3d89b-253">Route values: [operation, create], [id, 3]</span></span> |
| <span data-ttu-id="3d89b-254">/package/track/-3</span><span class="sxs-lookup"><span data-stu-id="3d89b-254">/package/track/-3</span></span>    | <span data-ttu-id="3d89b-255">Hello!</span><span class="sxs-lookup"><span data-stu-id="3d89b-255">Hello!</span></span> <span data-ttu-id="3d89b-256">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="3d89b-256">Route values: [operation, track], [id, -3]</span></span> |
| <span data-ttu-id="3d89b-257">/package/track/-3/</span><span class="sxs-lookup"><span data-stu-id="3d89b-257">/package/track/-3/</span></span>   | <span data-ttu-id="3d89b-258">Hello!</span><span class="sxs-lookup"><span data-stu-id="3d89b-258">Hello!</span></span> <span data-ttu-id="3d89b-259">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="3d89b-259">Route values: [operation, track], [id, -3]</span></span> |
| <span data-ttu-id="3d89b-260">/package/track/</span><span class="sxs-lookup"><span data-stu-id="3d89b-260">/package/track/</span></span>      | <span data-ttu-id="3d89b-261">&lt;失败，无任何匹配&gt;</span><span class="sxs-lookup"><span data-stu-id="3d89b-261">&lt;Fall through, no match&gt;</span></span>                    |
| <span data-ttu-id="3d89b-262">GET /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="3d89b-262">GET /hello/Joe</span></span>       | <span data-ttu-id="3d89b-263">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="3d89b-263">Hi, Joe!</span></span>                                          |
| <span data-ttu-id="3d89b-264">POST /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="3d89b-264">POST /hello/Joe</span></span>      | <span data-ttu-id="3d89b-265">&lt;失败，仅匹配 HTTP GET&gt;</span><span class="sxs-lookup"><span data-stu-id="3d89b-265">&lt;Fall through, matches HTTP GET only&gt;</span></span>       |
| <span data-ttu-id="3d89b-266">GET /hello/Joe/Smith</span><span class="sxs-lookup"><span data-stu-id="3d89b-266">GET /hello/Joe/Smith</span></span> | <span data-ttu-id="3d89b-267">&lt;失败，无任何匹配&gt;</span><span class="sxs-lookup"><span data-stu-id="3d89b-267">&lt;Fall through, no match&gt;</span></span>                    |

<span data-ttu-id="3d89b-268">如果要配置单个路由，请在 `IRouter` 实例中调用 <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> 传入。</span><span class="sxs-lookup"><span data-stu-id="3d89b-268">If you're configuring a single route, call <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passing in an `IRouter` instance.</span></span> <span data-ttu-id="3d89b-269">无需使用 <xref:Microsoft.AspNetCore.Routing.RouteBuilder>。</span><span class="sxs-lookup"><span data-stu-id="3d89b-269">You won't need to use <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span></span>

<span data-ttu-id="3d89b-270">框架可提供一组扩展方法，用于创建如下路由：</span><span class="sxs-lookup"><span data-stu-id="3d89b-270">The framework provides a set of extension methods for creating routes, such as:</span></span>

* `MapRoute`
* `MapGet`
* `MapPost`
* `MapPut`
* `MapDelete`
* `MapVerb`

<span data-ttu-id="3d89b-271">某些方法（如 `MapGet`）需要提供 `RequestDelegate`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-271">Some of these methods, such as `MapGet`, require a `RequestDelegate` to be provided.</span></span> <span data-ttu-id="3d89b-272">路由匹配时，`RequestDelegate` 会用作路由处理程序。</span><span class="sxs-lookup"><span data-stu-id="3d89b-272">The `RequestDelegate` is used as the *route handler* when the route matches.</span></span> <span data-ttu-id="3d89b-273">此系列中的其他方法允许配置中间件管道，将其用作路由处理程序。</span><span class="sxs-lookup"><span data-stu-id="3d89b-273">Other methods in this family allow configuring a middleware pipeline for use as the route handler.</span></span> <span data-ttu-id="3d89b-274">如果 Map 方法不接受处理程序（如 `MapRoute`），则它将使用 <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>。</span><span class="sxs-lookup"><span data-stu-id="3d89b-274">If the *Map* method doesn't accept a handler, such as `MapRoute`, then it uses the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span>

<span data-ttu-id="3d89b-275">`Map[Verb]` 方法将使用约束来将路由限制为方法名称中的 HTTP 谓词。</span><span class="sxs-lookup"><span data-stu-id="3d89b-275">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="3d89b-276">有关示例，请参阅 <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> 和 <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>。</span><span class="sxs-lookup"><span data-stu-id="3d89b-276">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="3d89b-277">路由模板参考</span><span class="sxs-lookup"><span data-stu-id="3d89b-277">Route template reference</span></span>

<span data-ttu-id="3d89b-278">如果路由找到匹配项，大括号 (`{ ... }`) 内的令牌定义绑定的路由参数。</span><span class="sxs-lookup"><span data-stu-id="3d89b-278">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="3d89b-279">可在路由段中定义多个路由参数，但必须由文本值隔开。</span><span class="sxs-lookup"><span data-stu-id="3d89b-279">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="3d89b-280">例如，`{controller=Home}{action=Index}` 不是有效的路由，因为 `{controller}` 和 `{action}` 之间没有文本值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-280">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="3d89b-281">这些路由参数必须具有名称，且可能指定了其他属性。</span><span class="sxs-lookup"><span data-stu-id="3d89b-281">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="3d89b-282">路由参数以外的文本（例如 `{id}`）和路径分隔符 `/` 必须匹配 URL 中的文本。</span><span class="sxs-lookup"><span data-stu-id="3d89b-282">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="3d89b-283">文本匹配区分大小写，并且基于 URL 路径已解码的表示形式。</span><span class="sxs-lookup"><span data-stu-id="3d89b-283">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="3d89b-284">若要匹配文本路由参数分隔符 `{` 或 `}`，可通过重复该字符（`{{` 或 `}}`）对其进行转义。</span><span class="sxs-lookup"><span data-stu-id="3d89b-284">To match the literal route parameter delimiter `{` or  `}`, escape it by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="3d89b-285">尝试捕获具有可选文件扩展名的文件名的 URL 模式还有其他注意事项。</span><span class="sxs-lookup"><span data-stu-id="3d89b-285">URL patterns that attempt to capture a filename with an optional file extension have additional considerations.</span></span> <span data-ttu-id="3d89b-286">例如，考虑模板 `files/{filename}.{ext?}`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-286">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="3d89b-287">当 `filename` 和 `ext` 都存在时，将填充这两个值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-287">When both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="3d89b-288">如果 URL 中仅存在 `filename`，则路由匹配，因为尾随句点 `.` 是可选的。</span><span class="sxs-lookup"><span data-stu-id="3d89b-288">If only `filename` exists in the URL, the route matches because the trailing period `.` is  optional.</span></span> <span data-ttu-id="3d89b-289">以下 URL 与此路由相匹配：</span><span class="sxs-lookup"><span data-stu-id="3d89b-289">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="3d89b-290">你可以使用 `*` 字符作为路由参数的前缀，以绑定到 URI 的其余部分。</span><span class="sxs-lookup"><span data-stu-id="3d89b-290">You can use the `*` character as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="3d89b-291">这称为 catch-all 参数。</span><span class="sxs-lookup"><span data-stu-id="3d89b-291">This is called a *catch-all* parameter.</span></span> <span data-ttu-id="3d89b-292">例如，`blog/{*slug}` 将匹配以 `/blog` 开头且其后带有任何值（将分配给 `slug` 路由值）的 URI。</span><span class="sxs-lookup"><span data-stu-id="3d89b-292">For example, `blog/{*slug}` matches any URI that starts with `/blog` and had any value following it (which is assigned to the `slug` route value).</span></span> <span data-ttu-id="3d89b-293">全方位参数还可以匹配空字符串。</span><span class="sxs-lookup"><span data-stu-id="3d89b-293">Catch-all parameters can also match the empty string.</span></span>

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="3d89b-294">使用路由生成 URL（包括路径分隔符 (`/`)）时，catch-all 参数会转义相应的字符。</span><span class="sxs-lookup"><span data-stu-id="3d89b-294">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="3d89b-295">例如，路由值为 `{ path = "my/path" }` 的路由 `foo/{*path}` 生成 `foo/my%2Fpath`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-295">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="3d89b-296">请注意转义的正斜杠。</span><span class="sxs-lookup"><span data-stu-id="3d89b-296">Note the escaped forward slash.</span></span> <span data-ttu-id="3d89b-297">要往返路径分隔符，请使用 `**` 路由参数前缀。</span><span class="sxs-lookup"><span data-stu-id="3d89b-297">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="3d89b-298">`{ path = "my/path" }` 的路由 `foo/{**path}` 生成 `foo/my/path`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-298">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

::: moniker-end

<span data-ttu-id="3d89b-299">路由参数可能具有指定的默认值，方法是在参数名称后使用等号 (`=`) 隔开以指定默认值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-299">Route parameters may have *default values*, designated by specifying the default after the parameter name, separated by an equals sign (`=`).</span></span> <span data-ttu-id="3d89b-300">例如，`{controller=Home}` 将 `Home` 定义为 `controller` 的默认值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-300">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="3d89b-301">如果参数的 URL 中不存在任何值，则使用默认值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-301">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="3d89b-302">除默认值外，路由参数可能是可选的，如 `id?` 中所示，通过将问号 (`?`) 追加到参数名称末尾来指定。</span><span class="sxs-lookup"><span data-stu-id="3d89b-302">In addition to default values, route parameters may be optional, specified by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="3d89b-303">可选值和默认路径参数的区别在于具有默认值的路由参数始终会生成一个值，而可选参数仅当请求 URL 提供值时才会具有一个值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-303">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value; an optional parameter has a value only when a value is provided by the request URL.</span></span>

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="3d89b-304">路由参数可能具有约束，必须匹配从 URL 中绑定的路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-304">Route parameters may have constraints, which must match the route value bound from the URL.</span></span> <span data-ttu-id="3d89b-305">在路由参数后面添加一个冒号 (`:`) 和约束名称可指定路由参数上的内联约束。</span><span class="sxs-lookup"><span data-stu-id="3d89b-305">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="3d89b-306">如果约束需要参数，将以在约束名称后括在括号 `( )` 中的形式提供。</span><span class="sxs-lookup"><span data-stu-id="3d89b-306">If the constraint requires arguments, they're enclosed in parentheses `( )` after the constraint name.</span></span> <span data-ttu-id="3d89b-307">通过追加另一个冒号 (`:`) 和约束名称，可指定多个内联约束。</span><span class="sxs-lookup"><span data-stu-id="3d89b-307">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span> <span data-ttu-id="3d89b-308">约束名称和参数将传递给 <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> 服务，以创建 <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> 的实例，用于处理 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-308">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="3d89b-309">如果约束构造函数要求服务，通过依赖关系注入的应用服务解决它们。</span><span class="sxs-lookup"><span data-stu-id="3d89b-309">If the constraint constructor requires services, they're resolved from dependency injection's app services.</span></span> <span data-ttu-id="3d89b-310">例如，路由模板 `blog/{article:minlength(10)}` 使用参数 `10` 指定 `minlength` 约束。</span><span class="sxs-lookup"><span data-stu-id="3d89b-310">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="3d89b-311">有关路由约束详情以及框架提供的约束列表，请参阅[路由约束引用](#route-constraint-reference)部分。</span><span class="sxs-lookup"><span data-stu-id="3d89b-311">For more information on route constraints and a listing of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="3d89b-312">路由参数可能具有约束，必须匹配从 URL 中绑定的路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-312">Route parameters may have constraints, which must match the route value bound from the URL.</span></span> <span data-ttu-id="3d89b-313">在路由参数后面添加一个冒号 (`:`) 和约束名称可指定路由参数上的内联约束。</span><span class="sxs-lookup"><span data-stu-id="3d89b-313">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="3d89b-314">如果约束需要参数，将以在约束名称后括在括号 `( )` 中的形式提供。</span><span class="sxs-lookup"><span data-stu-id="3d89b-314">If the constraint requires arguments, they're enclosed in parentheses `( )` after the constraint name.</span></span> <span data-ttu-id="3d89b-315">通过追加另一个冒号 (`:`) 和约束名称，可指定多个内联约束。</span><span class="sxs-lookup"><span data-stu-id="3d89b-315">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span> <span data-ttu-id="3d89b-316">约束名称和参数将传递给 <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> 服务，以创建 <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> 的实例，用于处理 URL。</span><span class="sxs-lookup"><span data-stu-id="3d89b-316">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="3d89b-317">例如，路由模板 `blog/{article:minlength(10)}` 使用参数 `10` 指定 `minlength` 约束。</span><span class="sxs-lookup"><span data-stu-id="3d89b-317">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="3d89b-318">有关路由约束详情以及框架提供的约束列表，请参阅[路由约束引用](#route-constraint-reference)部分。</span><span class="sxs-lookup"><span data-stu-id="3d89b-318">For more information on route constraints and a listing of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

::: moniker-end

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="3d89b-319">路由参数还可以具有参数转换器，用于在生成链接以及将操作和页面匹配到 URI 时转换参数的值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-319">Route parameters may also have parameter transformers, which transform a parameter's value when generating links and matching actions and pages to URIs.</span></span> <span data-ttu-id="3d89b-320">与约束类似，可以通过在路由参数名称后面添加冒号 (`:`) 和转换器名称，将参数变换器内联添加到路径参数。</span><span class="sxs-lookup"><span data-stu-id="3d89b-320">Like constraints, parameter transformers can be added inline to a route parameter by adding a colon (`:`) and transformer name after the route parameter name.</span></span> <span data-ttu-id="3d89b-321">例如，路由模板 `blog/{article:slugify}` 指定 `slugify` 转换器。</span><span class="sxs-lookup"><span data-stu-id="3d89b-321">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span>

::: moniker-end

<span data-ttu-id="3d89b-322">下表演示某些路由模板及其行为。</span><span class="sxs-lookup"><span data-stu-id="3d89b-322">The following table demonstrates some route templates and their behavior.</span></span>

| <span data-ttu-id="3d89b-323">路由模板</span><span class="sxs-lookup"><span data-stu-id="3d89b-323">Route Template</span></span>                         | <span data-ttu-id="3d89b-324">匹配 URL 示例</span><span class="sxs-lookup"><span data-stu-id="3d89b-324">Example Matching URL</span></span>  | <span data-ttu-id="3d89b-325">说明</span><span class="sxs-lookup"><span data-stu-id="3d89b-325">Notes</span></span>                                                                  |
| -------------------------------------- | --------------------- | ---------------------------------------------------------------------- |
| <span data-ttu-id="3d89b-326">hello</span><span class="sxs-lookup"><span data-stu-id="3d89b-326">hello</span></span>                                  | <span data-ttu-id="3d89b-327">/hello</span><span class="sxs-lookup"><span data-stu-id="3d89b-327">/hello</span></span>                | <span data-ttu-id="3d89b-328">仅匹配单个路径 `/hello`</span><span class="sxs-lookup"><span data-stu-id="3d89b-328">Only matches the single path `/hello`</span></span>                                  |
| <span data-ttu-id="3d89b-329">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="3d89b-329">{Page=Home}</span></span>                            | /                     | <span data-ttu-id="3d89b-330">匹配并将 `Page` 设置为 `Home`</span><span class="sxs-lookup"><span data-stu-id="3d89b-330">Matches and sets `Page` to `Home`</span></span>                                      |
| <span data-ttu-id="3d89b-331">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="3d89b-331">{Page=Home}</span></span>                            | <span data-ttu-id="3d89b-332">/Contact</span><span class="sxs-lookup"><span data-stu-id="3d89b-332">/Contact</span></span>              | <span data-ttu-id="3d89b-333">匹配并将 `Page` 设置为 `Contact`</span><span class="sxs-lookup"><span data-stu-id="3d89b-333">Matches and sets `Page` to `Contact`</span></span>                                   |
| <span data-ttu-id="3d89b-334">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="3d89b-334">{controller}/{action}/{id?}</span></span>            | <span data-ttu-id="3d89b-335">/Products/List</span><span class="sxs-lookup"><span data-stu-id="3d89b-335">/Products/List</span></span>        | <span data-ttu-id="3d89b-336">映射到 `Products` 控制器和 `List` 操作</span><span class="sxs-lookup"><span data-stu-id="3d89b-336">Maps to `Products` controller and `List`  action</span></span>                       |
| <span data-ttu-id="3d89b-337">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="3d89b-337">{controller}/{action}/{id?}</span></span>            | <span data-ttu-id="3d89b-338">/Products/Details/123</span><span class="sxs-lookup"><span data-stu-id="3d89b-338">/Products/Details/123</span></span> |  <span data-ttu-id="3d89b-339">映射到 `Products` 控制器和 `Details` 操作。</span><span class="sxs-lookup"><span data-stu-id="3d89b-339">Maps to `Products` controller and  `Details` action.</span></span>  <span data-ttu-id="3d89b-340">将 `id` 设置为 123</span><span class="sxs-lookup"><span data-stu-id="3d89b-340">`id` set to 123</span></span> |
| <span data-ttu-id="3d89b-341">{controller=Home}/{action=Index}/{id?}</span><span class="sxs-lookup"><span data-stu-id="3d89b-341">{controller=Home}/{action=Index}/{id?}</span></span> | /                     |  <span data-ttu-id="3d89b-342">映射到 `Home` 控制器和 `Index` 方法；将忽略 `id`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-342">Maps to `Home` controller and `Index`  method; `id` is ignored.</span></span>       |

<span data-ttu-id="3d89b-343">使用模板通常是进行路由最简单的方法。</span><span class="sxs-lookup"><span data-stu-id="3d89b-343">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="3d89b-344">还可在路由模板外指定约束和默认值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-344">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="3d89b-345">启用[日志记录](xref:fundamentals/logging/index)查看内置路由实现（如 `Route`）如何匹配请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-345">Enable [Logging](xref:fundamentals/logging/index) to see how the built in routing implementations, such as `Route`, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="3d89b-346">保留的路由名称</span><span class="sxs-lookup"><span data-stu-id="3d89b-346">Reserved routing names</span></span>

<span data-ttu-id="3d89b-347">以下关键字是保留的名称，它们不能用作路由名称或参数：</span><span class="sxs-lookup"><span data-stu-id="3d89b-347">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="3d89b-348">路由约束参考</span><span class="sxs-lookup"><span data-stu-id="3d89b-348">Route constraint reference</span></span>

<span data-ttu-id="3d89b-349">如果 `Route` 匹配传入 URL 的语法并将 URL 路径标记化为路由值，将执行路由约束。</span><span class="sxs-lookup"><span data-stu-id="3d89b-349">Route constraints execute when a `Route` has matched the syntax of the incoming URL and tokenized the URL path into route values.</span></span> <span data-ttu-id="3d89b-350">路径约束通常检查通过路径模板关联的路径值，并对该值是否可接受做出是/否决定。</span><span class="sxs-lookup"><span data-stu-id="3d89b-350">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="3d89b-351">某些路由约束使用路由值以外的数据来考虑是否可以路由请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-351">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="3d89b-352">例如，<xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> 可以根据其 HTTP 谓词接受或拒绝请求。</span><span class="sxs-lookup"><span data-stu-id="3d89b-352">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span>

> [!WARNING]
> <span data-ttu-id="3d89b-353">避免使用输入验证约束，因为这样意味着无效输入将导致“404 - 未找到”响应，而不是含相应错误消息的“400 - 错误请求”。</span><span class="sxs-lookup"><span data-stu-id="3d89b-353">Avoid using constraints for **input validation** because doing so means that invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="3d89b-354">路由约束用于消除类似路由间的歧义，而不是验证特定路由的输入。</span><span class="sxs-lookup"><span data-stu-id="3d89b-354">Route constraints are used to **disambiguate** between similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="3d89b-355">下表演示某些路由约束及其预期行为。</span><span class="sxs-lookup"><span data-stu-id="3d89b-355">The following table demonstrates some route constraints and their expected behavior.</span></span>

| <span data-ttu-id="3d89b-356">约束</span><span class="sxs-lookup"><span data-stu-id="3d89b-356">constraint</span></span> | <span data-ttu-id="3d89b-357">示例</span><span class="sxs-lookup"><span data-stu-id="3d89b-357">Example</span></span> | <span data-ttu-id="3d89b-358">匹配项示例</span><span class="sxs-lookup"><span data-stu-id="3d89b-358">Example Matches</span></span> | <span data-ttu-id="3d89b-359">说明</span><span class="sxs-lookup"><span data-stu-id="3d89b-359">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="3d89b-360">`123456789`， `-123456789`</span><span class="sxs-lookup"><span data-stu-id="3d89b-360">`123456789`, `-123456789`</span></span>  | <span data-ttu-id="3d89b-361">匹配任何整数</span><span class="sxs-lookup"><span data-stu-id="3d89b-361">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="3d89b-362">`true`， `FALSE`</span><span class="sxs-lookup"><span data-stu-id="3d89b-362">`true`, `FALSE`</span></span> | <span data-ttu-id="3d89b-363">匹配 `true`或 `false`（区分大小写）</span><span class="sxs-lookup"><span data-stu-id="3d89b-363">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="3d89b-364">`2016-12-31`， `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="3d89b-364">`2016-12-31`, `2016-12-31 7:32pm`</span></span>  | <span data-ttu-id="3d89b-365">匹配有效的 `DateTime` 值（位于固定区域性中 - 查看警告）</span><span class="sxs-lookup"><span data-stu-id="3d89b-365">Matches a valid `DateTime` value (in the invariant culture - see warning)</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="3d89b-366">`49.99`， `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="3d89b-366">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="3d89b-367">匹配有效的 `decimal` 值（位于固定区域性中 - 查看警告）</span><span class="sxs-lookup"><span data-stu-id="3d89b-367">Matches a valid `decimal` value (in the invariant culture - see warning)</span></span> |
| `double` | `{weight:double}` | <span data-ttu-id="3d89b-368">`1.234`， `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="3d89b-368">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="3d89b-369">匹配有效的 `double` 值（位于固定区域性中 - 查看警告）</span><span class="sxs-lookup"><span data-stu-id="3d89b-369">Matches a valid `double` value (in the invariant culture - see warning)</span></span> |
| `float` | `{weight:float}` | <span data-ttu-id="3d89b-370">`1.234`， `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="3d89b-370">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="3d89b-371">匹配有效的 `float` 值（位于固定区域性中 - 查看警告）</span><span class="sxs-lookup"><span data-stu-id="3d89b-371">Matches a valid `float` value (in the invariant culture - see warning)</span></span> |
| `guid` | `{id:guid}` | <span data-ttu-id="3d89b-372">`CD2C1638-1638-72D5-1638-DEADBEEF1638`， `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="3d89b-372">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="3d89b-373">匹配有效的 `Guid` 值</span><span class="sxs-lookup"><span data-stu-id="3d89b-373">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="3d89b-374">`123456789`， `-123456789`</span><span class="sxs-lookup"><span data-stu-id="3d89b-374">`123456789`, `-123456789`</span></span> | <span data-ttu-id="3d89b-375">匹配有效的 `long` 值</span><span class="sxs-lookup"><span data-stu-id="3d89b-375">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="3d89b-376">字符串必须至少为 4 个字符</span><span class="sxs-lookup"><span data-stu-id="3d89b-376">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="3d89b-377">字符串不得超过 8 个字符</span><span class="sxs-lookup"><span data-stu-id="3d89b-377">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="3d89b-378">字符串必须正好为 12 个字符</span><span class="sxs-lookup"><span data-stu-id="3d89b-378">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="3d89b-379">字符串必须至少为 8 个字符，且不得超过 16 个字符</span><span class="sxs-lookup"><span data-stu-id="3d89b-379">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="3d89b-380">整数值必须至少为 18</span><span class="sxs-lookup"><span data-stu-id="3d89b-380">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="3d89b-381">整数值不得超过 120</span><span class="sxs-lookup"><span data-stu-id="3d89b-381">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="3d89b-382">整数值必须至少为 18，且不得超过 120</span><span class="sxs-lookup"><span data-stu-id="3d89b-382">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="3d89b-383">字符串必须由一个或多个字母字符（`a`-`z`，区分大小写）组成</span><span class="sxs-lookup"><span data-stu-id="3d89b-383">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="3d89b-384">字符串必须匹配正则表达式（参见有关定义正则表达式的提示）</span><span class="sxs-lookup"><span data-stu-id="3d89b-384">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` |  <span data-ttu-id="3d89b-385">用于强制在 URL 生成过程中存在非参数值</span><span class="sxs-lookup"><span data-stu-id="3d89b-385">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="3d89b-386">可向单个参数应用多个由冒号分隔的约束。</span><span class="sxs-lookup"><span data-stu-id="3d89b-386">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="3d89b-387">例如，以下约束将参数限制为大于或等于 1 的整数值：</span><span class="sxs-lookup"><span data-stu-id="3d89b-387">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="3d89b-388">验证 URL 的路由约束并将转换为始终使用固定区域性的 CLR 类型（例如 `int` 或 `DateTime`）。</span><span class="sxs-lookup"><span data-stu-id="3d89b-388">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="3d89b-389">这些约束假定 URL 不可本地化。</span><span class="sxs-lookup"><span data-stu-id="3d89b-389">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="3d89b-390">框架提供的路由约束不会修改存储于路由值中的值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-390">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="3d89b-391">从 URL 中分析的所有路由值都将存储为字符串。</span><span class="sxs-lookup"><span data-stu-id="3d89b-391">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="3d89b-392">例如，`float` 约束会尝试将路由值转换为浮点数，但转换后的值仅用来验证其是否可转换为浮点数。</span><span class="sxs-lookup"><span data-stu-id="3d89b-392">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="3d89b-393">正则表达式</span><span class="sxs-lookup"><span data-stu-id="3d89b-393">Regular expressions</span></span>

<span data-ttu-id="3d89b-394">ASP.NET Core 框架将向正则表达式构造函数添加 `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-394">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="3d89b-395">有关这些成员的说明，请参阅 <xref:System.Text.RegularExpressions.RegexOptions>。</span><span class="sxs-lookup"><span data-stu-id="3d89b-395">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="3d89b-396">正则表达式与路由和 C# 计算机语言使用的分隔符和令牌相似。</span><span class="sxs-lookup"><span data-stu-id="3d89b-396">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="3d89b-397">必须对正则表达式令牌进行转义。</span><span class="sxs-lookup"><span data-stu-id="3d89b-397">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="3d89b-398">若要在路由中使用正则表达式 `^\d{3}-\d{2}-\d{4}$`，则表达式必须要有如 C# 源文件中键入的 `\\` 一样的 `\` 字符，以转义 `\` 字符串转义字符（除非使用 [verbatim 字符串文本](/dotnet/csharp/language-reference/keywords/string)）。</span><span class="sxs-lookup"><span data-stu-id="3d89b-398">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in Routing, the expression must have the `\` characters typed in as `\\` in the C# source file to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span> <span data-ttu-id="3d89b-399">`{`、`}`、`[` 和 `]` 字符必须成双进行转义，以转义路由参数分隔符字符。</span><span class="sxs-lookup"><span data-stu-id="3d89b-399">The `{`, `}`, `[`, and `]` characters must be escaped by doubling them to escape the Routing parameter delimiter characters.</span></span> <span data-ttu-id="3d89b-400">下表显示正则表达式和转义的版本。</span><span class="sxs-lookup"><span data-stu-id="3d89b-400">The table below shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="3d89b-401">表达式</span><span class="sxs-lookup"><span data-stu-id="3d89b-401">Expression</span></span>            | <span data-ttu-id="3d89b-402">已转义</span><span class="sxs-lookup"><span data-stu-id="3d89b-402">Escaped</span></span>                        |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="3d89b-403">路由中使用的正则表达式通常以 `^` 字符（匹配字符串的起始位置）开头，以 `$` 字符（匹配字符串的结束位置）结尾。</span><span class="sxs-lookup"><span data-stu-id="3d89b-403">Regular expressions used in routing often start with the `^` character (match starting position of the string) and end with the `$` character (match ending position of the string).</span></span> <span data-ttu-id="3d89b-404">`^` 和 `$` 字符可确保正则表达式匹配整个路由参数值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-404">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="3d89b-405">如果没有 `^` 和 `$` 字符，正则表达式将匹配字符串内的所有子字符串，而这通常是不需要的。</span><span class="sxs-lookup"><span data-stu-id="3d89b-405">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="3d89b-406">下表显示部分示例，并说明它们为何匹配或未能匹配。</span><span class="sxs-lookup"><span data-stu-id="3d89b-406">The table below shows some examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="3d89b-407">表达式</span><span class="sxs-lookup"><span data-stu-id="3d89b-407">Expression</span></span>   | <span data-ttu-id="3d89b-408">String</span><span class="sxs-lookup"><span data-stu-id="3d89b-408">String</span></span>    | <span data-ttu-id="3d89b-409">匹配</span><span class="sxs-lookup"><span data-stu-id="3d89b-409">Match</span></span> | <span data-ttu-id="3d89b-410">注释</span><span class="sxs-lookup"><span data-stu-id="3d89b-410">Comment</span></span>               |
| ------------ | --------- |  ---- |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="3d89b-411">hello</span><span class="sxs-lookup"><span data-stu-id="3d89b-411">hello</span></span>     | <span data-ttu-id="3d89b-412">是</span><span class="sxs-lookup"><span data-stu-id="3d89b-412">Yes</span></span>   | <span data-ttu-id="3d89b-413">子字符串匹配</span><span class="sxs-lookup"><span data-stu-id="3d89b-413">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="3d89b-414">123abc456</span><span class="sxs-lookup"><span data-stu-id="3d89b-414">123abc456</span></span> | <span data-ttu-id="3d89b-415">是</span><span class="sxs-lookup"><span data-stu-id="3d89b-415">Yes</span></span>   | <span data-ttu-id="3d89b-416">子字符串匹配</span><span class="sxs-lookup"><span data-stu-id="3d89b-416">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="3d89b-417">mz</span><span class="sxs-lookup"><span data-stu-id="3d89b-417">mz</span></span>        | <span data-ttu-id="3d89b-418">是</span><span class="sxs-lookup"><span data-stu-id="3d89b-418">Yes</span></span>   | <span data-ttu-id="3d89b-419">匹配表达式</span><span class="sxs-lookup"><span data-stu-id="3d89b-419">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="3d89b-420">MZ</span><span class="sxs-lookup"><span data-stu-id="3d89b-420">MZ</span></span>        | <span data-ttu-id="3d89b-421">是</span><span class="sxs-lookup"><span data-stu-id="3d89b-421">Yes</span></span>   | <span data-ttu-id="3d89b-422">不区分大小写</span><span class="sxs-lookup"><span data-stu-id="3d89b-422">Not case sensitive</span></span>    |
| `^[a-z]{2}$` |  <span data-ttu-id="3d89b-423">hello</span><span class="sxs-lookup"><span data-stu-id="3d89b-423">hello</span></span>    | <span data-ttu-id="3d89b-424">否</span><span class="sxs-lookup"><span data-stu-id="3d89b-424">No</span></span>    | <span data-ttu-id="3d89b-425">参阅上述 `^` 和 `$`</span><span class="sxs-lookup"><span data-stu-id="3d89b-425">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="3d89b-426">123abc456</span><span class="sxs-lookup"><span data-stu-id="3d89b-426">123abc456</span></span> | <span data-ttu-id="3d89b-427">否</span><span class="sxs-lookup"><span data-stu-id="3d89b-427">No</span></span>    | <span data-ttu-id="3d89b-428">参阅上述 `^` 和 `$`</span><span class="sxs-lookup"><span data-stu-id="3d89b-428">See `^` and `$` above</span></span> |

<span data-ttu-id="3d89b-429">有关正则表达式语法的详细信息，请参阅 [.NET Framework 正则表达式](/dotnet/standard/base-types/regular-expression-language-quick-reference)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-429">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="3d89b-430">若要将参数限制为一组已知的可能值，可使用正则表达式。</span><span class="sxs-lookup"><span data-stu-id="3d89b-430">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="3d89b-431">例如，`{action:regex(^(list|get|create)$)}` 仅将 `action` 路由值匹配到 `list`、`get` 或 `create`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-431">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="3d89b-432">如果传递到约束字典中，字符串 `^(list|get|create)$` 将等效。</span><span class="sxs-lookup"><span data-stu-id="3d89b-432">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="3d89b-433">已传递到约束字典（不与模板内联）且不匹配任何已知约束的约束还将被视为正则表达式。</span><span class="sxs-lookup"><span data-stu-id="3d89b-433">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

::: moniker range=">= aspnetcore-2.2"

## <a name="parameter-transformer-reference"></a><span data-ttu-id="3d89b-434">参数转换器参考</span><span class="sxs-lookup"><span data-stu-id="3d89b-434">Parameter transformer reference</span></span>

<span data-ttu-id="3d89b-435">参数转换器：</span><span class="sxs-lookup"><span data-stu-id="3d89b-435">Parameter transformers:</span></span>

* <span data-ttu-id="3d89b-436">在为 `Route` 生成链接时执行。</span><span class="sxs-lookup"><span data-stu-id="3d89b-436">Execute when generating a link for a `Route`.</span></span>
* <span data-ttu-id="3d89b-437">实现 `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-437">Implement `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span></span>
* <span data-ttu-id="3d89b-438">使用 <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> 进行配置。</span><span class="sxs-lookup"><span data-stu-id="3d89b-438">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="3d89b-439">获取参数的路由值并将其转换为新的字符串值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-439">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="3d89b-440">转换后的值用于生成的链接。</span><span class="sxs-lookup"><span data-stu-id="3d89b-440">The transformed value is used in the generated link.</span></span>

<span data-ttu-id="3d89b-441">例如，路由模式 `blog\{article:slugify}`（具有 `Url.Action(new { article = "MyTestArticle" })`）中的自定义 `slugify` 参数转换器生成 `blog\my-test-article`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-441">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="3d89b-442">框架还使用参数转换器来转换端点解析的 URI。</span><span class="sxs-lookup"><span data-stu-id="3d89b-442">Parameter transformers are also used by frameworks to transform the URI to which an endpoint resolves.</span></span> <span data-ttu-id="3d89b-443">例如，ASP.NET Core MVC 使用参数转换器来转换用于匹配 `area``controller``action` 和 `page` 的路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-443">For example, ASP.NET Core MVC uses parameter transformers to transform the route value used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home:slugify}/{action=Index:slugify}/{id?}");
```

<span data-ttu-id="3d89b-444">使用上述路由，操作 `SubscriptionManagementController.GetAll()` 与 URI `/subscription-management/get-all` 匹配。</span><span class="sxs-lookup"><span data-stu-id="3d89b-444">With the preceding route, the action `SubscriptionManagementController.GetAll()` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="3d89b-445">参数转换器不会更改用于生成链接的路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-445">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="3d89b-446">`Url.Action("GetAll", "SubscriptionManagement")` 输出 `/subscription-management/get-all`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-446">`Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="3d89b-447">对于结合使用参数转换器和所生成的路由，ASP.NET Core 提供了 API 约定：</span><span class="sxs-lookup"><span data-stu-id="3d89b-447">ASP.NET Core provides API conventions for using a parameter transformers with generated routes:</span></span>

* <span data-ttu-id="3d89b-448">ASP.NET Core MVC 还具有 `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API 约定。</span><span class="sxs-lookup"><span data-stu-id="3d89b-448">ASP.NET Core MVC has the `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API convention.</span></span> <span data-ttu-id="3d89b-449">该约定将指定的参数转换器应用于应用中的所有属性路由。</span><span class="sxs-lookup"><span data-stu-id="3d89b-449">This convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="3d89b-450">在替换属性路径令牌时，参数转换器将转换这些令牌。</span><span class="sxs-lookup"><span data-stu-id="3d89b-450">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="3d89b-451">有关详细信息，请参阅[使用参数转换器自定义标记替换](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-451">For more information, see [Use a parameter transformer to customize token replacement](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="3d89b-452">Razor 页面具有 `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API 约定。</span><span class="sxs-lookup"><span data-stu-id="3d89b-452">Razor pages has the `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API convention.</span></span> <span data-ttu-id="3d89b-453">此约定将指定的参数转换器应用于所有自动发现的 Razor 页面。</span><span class="sxs-lookup"><span data-stu-id="3d89b-453">This convention applies a specified parameter transformer to all automatically discovered Razor pages.</span></span> <span data-ttu-id="3d89b-454">参数转换器将转换 Razor 页面路由的文件夹和文件名段。</span><span class="sxs-lookup"><span data-stu-id="3d89b-454">The parameter transformer transforms the folder and file name segments of Razor page routes.</span></span> <span data-ttu-id="3d89b-455">有关详细信息，请参阅[使用参数转换器自定义页面路由](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes)。</span><span class="sxs-lookup"><span data-stu-id="3d89b-455">For more information, see [Use a parameter transformer to customize page routes](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

::: moniker-end

## <a name="url-generation-reference"></a><span data-ttu-id="3d89b-456">URL 生成参考</span><span class="sxs-lookup"><span data-stu-id="3d89b-456">URL generation reference</span></span>

<span data-ttu-id="3d89b-457">以下示例演示如何在给定路由值字典和 <xref:Microsoft.AspNetCore.Routing.RouteCollection> 的情况下生成路由链接。</span><span class="sxs-lookup"><span data-stu-id="3d89b-457">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

::: moniker-end

<span data-ttu-id="3d89b-458">上述示例末尾生成的 `VirtualPath` 为 `/package/create/123`。</span><span class="sxs-lookup"><span data-stu-id="3d89b-458">The `VirtualPath` generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="3d89b-459">字典提供“跟踪包路由”模板 `package/{operation}/{id}` 的 `operation` 和 `id` 路由值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-459">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="3d89b-460">有关详细信息，请参阅[使用路由中间件](#use-routing-middleware)部分或[示例应用](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples)中的示例代码。</span><span class="sxs-lookup"><span data-stu-id="3d89b-460">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="3d89b-461">`VirtualPathContext` 构造函数的第二个参数是环境值的集合。</span><span class="sxs-lookup"><span data-stu-id="3d89b-461">The second parameter to the `VirtualPathContext` constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="3d89b-462">通过限制特定请求上下文中开发者必须指定的值数，环境值可提供便利。</span><span class="sxs-lookup"><span data-stu-id="3d89b-462">Ambient values provide convenience by limiting the number of values a developer must specify within a certain request context.</span></span> <span data-ttu-id="3d89b-463">当前请求的当前路由值被视为链接生成的环境值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-463">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="3d89b-464">在 ASP.NET Core MVC 应用中，如果处于 `HomeController` 的 `About` 操作中，则无需指定控制器路由值即可链接到 `Index` 操作&mdash;将使用 `Home` 环境值。</span><span class="sxs-lookup"><span data-stu-id="3d89b-464">In an ASP.NET Core MVC app if you are in the `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="3d89b-465">URL 中从左至右，将忽略不匹配参数的环境值，如果显式提供的值替代环境值，该环境值也将被忽略。</span><span class="sxs-lookup"><span data-stu-id="3d89b-465">Ambient values that don't match a parameter are ignored, and ambient values are also ignored when an explicitly provided value overrides it, going from left to right in the URL.</span></span>

<span data-ttu-id="3d89b-466">显式提供但不匹配任何对象的值将添加到查询字符串。</span><span class="sxs-lookup"><span data-stu-id="3d89b-466">Values that are explicitly provided but which don't match anything are added to the query string.</span></span> <span data-ttu-id="3d89b-467">下表显示使用路由模板 `{controller}/{action}/{id?}` 时的结果。</span><span class="sxs-lookup"><span data-stu-id="3d89b-467">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="3d89b-468">环境值</span><span class="sxs-lookup"><span data-stu-id="3d89b-468">Ambient Values</span></span>                | <span data-ttu-id="3d89b-469">显式值</span><span class="sxs-lookup"><span data-stu-id="3d89b-469">Explicit Values</span></span>                   | <span data-ttu-id="3d89b-470">结果</span><span class="sxs-lookup"><span data-stu-id="3d89b-470">Result</span></span>                  |
| ----------------------------- | --------------------------------- | ----------------------- |
| <span data-ttu-id="3d89b-471">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="3d89b-471">controller="Home"</span></span>             | <span data-ttu-id="3d89b-472">action="About"</span><span class="sxs-lookup"><span data-stu-id="3d89b-472">action="About"</span></span>                    | `/Home/About`           |
| <span data-ttu-id="3d89b-473">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="3d89b-473">controller="Home"</span></span>             | <span data-ttu-id="3d89b-474">controller="Order",action="About"</span><span class="sxs-lookup"><span data-stu-id="3d89b-474">controller="Order",action="About"</span></span> | `/Order/About`          |
| <span data-ttu-id="3d89b-475">controller="Home",color="Red"</span><span class="sxs-lookup"><span data-stu-id="3d89b-475">controller="Home",color="Red"</span></span> | <span data-ttu-id="3d89b-476">action="About"</span><span class="sxs-lookup"><span data-stu-id="3d89b-476">action="About"</span></span>                    | `/Home/About`           |
| <span data-ttu-id="3d89b-477">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="3d89b-477">controller="Home"</span></span>             | <span data-ttu-id="3d89b-478">action="About",color="Red"</span><span class="sxs-lookup"><span data-stu-id="3d89b-478">action="About",color="Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="3d89b-479">如果路由具有不对应于参数的默认值，且该值以显式方式提供，则它必须与默认值相匹配：</span><span class="sxs-lookup"><span data-stu-id="3d89b-479">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="3d89b-480">当提供控制器和操作的匹配值时，链接生成只生成此路由的链接。</span><span class="sxs-lookup"><span data-stu-id="3d89b-480">Link generation only generates a link for this route when the matching values for controller and action are provided.</span></span>
